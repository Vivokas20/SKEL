db: tests-examples/textbook/tables/22.sqlite
inputs:
  - tests-examples/textbook/tables/22-1.txt
  - tests-examples/textbook/tables/22-2.txt
  - tests-examples/textbook/tables/22-3.txt
output: tests-examples/textbook/tables/22.out
const:
  - green
aggrs:
  - n
attrs:
  - color
bools:
  - '!='
loc: 5
solution:
  - natural_join
  - summarise
  - natural_join3
  - filter
  - anti_join
comment: |
  5.2.10 optimal solution

  df4 <- inner_join(input2, input1)
  df5 <- df4 %>% group_by(S_key) %>% summarise(n = n()) %>% ungroup()
  df6 <- inner_join(input3, df5) %>% inner_join(input1)
  df7 <- df4 %>% filter(color != 'green')
  df8 <- anti_join(df6, df7, by=c('S_key'))
  out <- df8 %>% select(S_name, n) %>% arrange(S_name)
