db: tests-examples/textbook/tables/20.sqlite
inputs:
  - tests-examples/textbook/tables/20-1.txt
  - tests-examples/textbook/tables/20-2.txt
  - tests-examples/textbook/tables/20-3.txt
output: tests-examples/textbook/tables/20.out
constants:
  - red
  - green
columns:
  - color
bools:
  - ==
loc: 4
solution:
  - natural_join3
  - filter
  - filter
  - inner_join
comment: |
  # 5.2.8 optimal solution

  df4 <- inner_join(input1, input2) %>% inner_join(input3)
  df5 <- df4 %>% filter(color == 'red')
  df6 <- df4 %>% filter(color == 'green')
  df7 <- inner_join(df5, df6, by=c('S_key','S_name'), suffix = c('', '.other'))
  out <- df7 %>% select(S_name) %>% distinct() %>% arrange(S_name)
full_sketch: |
  T1 = natural_join(20-1, 20-2, 20-3)
  T2 = filter(T1, color == 'red')
  T3 = filter(T1, color == 'green')
  T4 = inner_join(T2, T3, (S_key, S_name))
  out = select distinct(S_name) order by(S_name)